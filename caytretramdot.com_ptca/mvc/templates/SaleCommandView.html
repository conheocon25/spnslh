<body>
	<div id="CommandPanel" class="panel panel-primary" tal:attributes="alt Command/getURLCheck;">
		<div class="panel-heading"><i class="glyphicon glyphicon-star"/> <B tal:content="php: 'LỆNH BÁN ' . Command->getDateTimePrint()"/></div>
		<div class="panel-body">
			<table width="100%">				
				<tr>
					<td width="25%">TẠO LÚC</td>
					<td width="45%"><B tal:content="Command/getDateTimePrint" /></td>
					<td width="30%"><B tal:content="Command/getBranch/getName"/></td>
				</tr>
				<tr>
					<td width="25%">NHÂN VIÊN LẬP</td>
					<td width="45%"><B tal:content="Command/getEmployee/getName" /></td>
					<td width="30%" />
				</tr>
				<tr>
					<td width="25%">TÌNH TRẠNG</td>
					<td width="45%"><B tal:content="Command/getStatePrint" /></td>					
					<td width="30%" />
				</tr>
			</table>
			<BR/>			
			<table class="table table-striped table-hover">
				<thead>
					<tr>										
						<th width="30">STT</th>
						<th><div class="text-left">TÊN</div></th>
						<th width="60"><div class="text-left">ĐVT</div></th>
						<th width="90"><div class="text-right">SL XIN</div></th>
						<th width="90"><div class="text-right">SL CẤP</div></th>												
					</tr>
				</thead>
				<tbody>
					<tr tal:repeat="Detail Command/getDetailAll">
						<td><div class="text-center" tal:content="repeat/Detail/number" /></td>
						<td><a 
							class="command-detail-item" href="#DialogGoodUpd" data-toggle="modal" 
							tal:attributes="id 			Detail/getId;
											id_command 	Detail/getIdCommand;
											id_good 	Detail/getIdGood;
											name_good	Detail/getGood/getName;
											count1 		Detail/getCount1;
											count2 		Detail/getCount2;											
							" 
							tal:content="Detail/getGood/getName"/>
						</td>
						<td><div class="text-left" tal:content="Detail/getGood/getUnit"/></td>
						<td><div class="text-right" tal:content="Detail/getCount1Print"/></td>
						<td><div class="text-right" tal:content="Detail/getCount2Print"/></td>
					</tr>
				</tbody>
			</table>
			<a class="Check btn btn-default" tal:attributes="data-url Command/getURLCheckExe">
				<i class="glyphicon glyphicon-ok"/> CHẤP THUẬN
			</a>
		</div>
	</div>
			
	<!-- DIALOG GOOD UPD-->
	<div id="DialogGoodUpd" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header"><h3><i class="glyphicon glyphicon-star modal-icon"/>CẬP NHẬT HÀNG HÓA</h3></div>
				<div id="FormGoodIns" class="form-horizontal">					
					<div class="form-group">
						<input id="DetailId2" type="hidden" class="form-control input-small" />
						<input id="DetailIdCommand2" type="hidden" class="form-control input-small" />
						<input id="DetailIdGood2" type="hidden" class="form-control input-small" />
						<label class="col-sm-3 control-label">Mặt hàng</label>
						<div class="col-sm-8 controls">
							<input id="DetailNameGood2" type="text" class="form-control input-small" readonly="true" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Số lượng xin</label>
						<div class="col-sm-8 controls">
							<input id="DetailCount12" type="text" class="form-control input-small" readonly="true"/>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Số lượng cấp</label>
						<div class="col-sm-8 controls">
							<input id="DetailCount22" type="text" class="form-control input-small" />
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary btn-small" id="URLGoodUpdButton"><i class="glyphicons-download_alt"/> Cập nhật</button>
						<button data-dismiss="modal" class="btn btn-default btn-small"><i class="glyphicons-undo"/> Hủy</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div metal:use-macro="mDialog.xhtml/DialogDel"/>
	
</body>
<script>							
	//Cập nhật HÀNG HÓA MỚI
	$("#DetailCount12").click(function(){		
		$("#DetailCount22").val($("#DetailCount12").val());
	});
	
	$(".command-detail-item").click(function(){						
		$("#DetailId2").val( $(this).attr('id') );
		$("#DetailIdCommand2").val( $(this).attr('id_command') );
		$("#DetailIdGood2").val( $(this).attr('id_good') );
		$("#DetailNameGood2").val( $(this).attr('name_good') );
		$("#DetailCount12").val( $(this).attr('count1') );
		$("#DetailCount22").val( $(this).attr('count2') );
	});
	
	$("#URLGoodUpdButton").click(function(){							
		var Data = [];		
		Data[0] = $("#DetailId2").val();
		Data[1] = $("#DetailIdCommand2").val();
		Data[2] = $("#DetailIdGood2").val();
		Data[3] = $("#DetailCount12").val();
		Data[4] = $("#DetailCount22").val();
		Data[5] = 0;
				
		var URL = "/object/upd/SaleCommandDetail";
		$.ajax({
			type: "POST",
			data: {Data:Data},
			url: URL,
			success: function(msg){
				var URL = $("#CommandPanel").attr('alt');
				$("#CommandView").load(URL);
			}
		});							
	});
			
	//-----------------------------------------------------------------------------------
	//GỬI TRÌNH
	//-----------------------------------------------------------------------------------	
	$(".Check").click(function(){
		var URLCheck = $(this).attr('data-url');
		$.ajax({
			type: "POST",					
			url: URLCheck,
			success: function(msg){
				location.reload();
			}
		});
	});
		
</script>