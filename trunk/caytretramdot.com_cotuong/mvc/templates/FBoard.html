<!DOCTYPE html>
<html lang="en">
	<head>
		<tal:block metal:use-macro="mFront.xhtml/IncludeMETA"/>
		<meta property="fb:app_id" content="1550985445183957"/>
		<meta property="og:title" tal:attributes="content Board/getName"/>
		<meta property="og:description" tal:attributes="content Board/getName"/>
		<meta property="og:image" tal:attributes="content Board/getThumb"/>
		<meta property="og:type" content="article" />
		<tal:block metal:use-macro="mFront.xhtml/IncludeCSS"/>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6 col-sm-4">
					<div class="row">						
						<a tal:attributes="href Chapter/getURLView" class="btn btn-sm" data-toggle="tooltip" data-placement="bottom" title="Về trang chủ"><i class="glyphicon glyphicon-home"/></a>
						<div class="btn btn-sm" data-toggle="modal" data-target="#Info" data-placement="bottom" title="Giới thiệu thông tin ván cờ"><B tal:content="Board/getName"/></div>						
						<div class="btn fb-like" tal:attributes="data-href Board/getURLShare" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>
					</div>
					<div class="row">
						<table width="100%" border="0" cellspacing="0" cellpadding="0" style="background-image: url(/data/chess/150/Board.jpg); background-size: 100% 100%;">
							<!-- TỌA ĐỘ-->
							<tr>
								<td width="10%" ><div class="text-center">1</div></td>
								<td width="10%" ><div class="text-center">2</div></td>
								<td width="10%" ><div class="text-center">3</div></td>
								<td width="10%" ><div class="text-center">4</div></td>
								<td width="10%" ><div class="text-center">5</div></td>
								<td width="10%" ><div class="text-center">6</div></td>
								<td width="10%" ><div class="text-center">7</div></td>
								<td width="10%" ><div class="text-center">8</div></td>
								<td width="10%" ><div class="text-center">9</div></td>
								<td width="10%" />
							</tr>
							
							<!-- R0-->
							<tr>
								<td width="10%" ><img class="CCell" width="100%" id="Piece00" X="0" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece10" X="1" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece20" X="2" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece30" X="3" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece40" X="4" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece50" X="5" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece60" X="6" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece70" X="7" Y="0"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece80" X="8" Y="0"/></td>
								<td width="10%"><img id="RoundGreen" width="50%" src="/data/chess/150/space.png" /></td>
							</tr>
							
							<!-- R1-->
							<tr>
								
								<td width="10%" ><img class="CCell" width="100%" id="Piece01" X="0" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece11" X="1" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece21" X="2" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece31" X="3" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece41" X="4" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece51" X="5" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece61" X="6" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece71" X="7" Y="1"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece81" X="8" Y="1"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>								
							</tr>
							
							<!-- R2-->
							<tr>
								
								<td width="10%" ><img class="CCell" width="100%" id="Piece02" X="0" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece12" X="1" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece22" X="2" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece32" X="3" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece42" X="4" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece52" X="5" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece62" X="6" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece72" X="7" Y="2"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece82" X="8" Y="2"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>
								
							</tr>														
							<!-- R3-->
							<tr>								
								<td width="10%" ><img class="CCell" width="100%" id="Piece03" X="0" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece13" X="1" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece23" X="2" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece33" X="3" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece43" X="4" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece53" X="5" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece63" X="6" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece73" X="7" Y="3"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece83" X="8" Y="3"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>								
							</tr>
														
							<!-- R4-->
							<tr>								
								<td width="10%" ><img class="CCell" width="100%" id="Piece04" X="0" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece14" X="1" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece24" X="2" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece34" X="3" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece44" X="4" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece54" X="5" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece64" X="6" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece74" X="7" Y="4"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece84" X="8" Y="4"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>								
							</tr>														
							<!-- R5-->
							<tr>								
								<td width="10%" ><img class="CCell" width="100%" id="Piece05" X="0" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece15" X="1" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece25" X="2" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece35" X="3" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece45" X="4" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece55" X="5" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece65" X="6" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece75" X="7" Y="5"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece85" X="8" Y="5"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>
							</tr>
							<!-- R6-->
							<tr>								
								<td width="10%" ><img class="CCell" width="100%" id="Piece06" X="0" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece16" X="1" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece26" X="2" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece36" X="3" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece46" X="4" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece56" X="5" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece66" X="6" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece76" X="7" Y="6"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece86" X="8" Y="6"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>								
							</tr>														
							<!-- R7-->
							<tr>
								<td width="10%" ><img class="CCell" width="100%" id="Piece07" X="0" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece17" X="1" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece27" X="2" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece37" X="3" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece47" X="4" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece57" X="5" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece67" X="6" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece77" X="7" Y="7"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece87" X="8" Y="7"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>
							</tr>														
							<!-- R8-->
							<tr>
								<td width="10%" ><img class="CCell" width="100%" id="Piece08" X="0" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece18" X="1" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece28" X="2" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece38" X="3" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece48" X="4" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece58" X="5" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece68" X="6" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece78" X="7" Y="8"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece88" X="8" Y="8"/></td>
								<td width="10%"><img width="100%" src="/data/chess/150/space.png" /></td>
							</tr>
																											
							<!-- R9-->
							<tr>
								<td width="10%" ><img class="CCell" width="100%" id="Piece09" X="0" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece19" X="1" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece29" X="2" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece39" X="3" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece49" X="4" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece59" X="5" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece69" X="6" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece79" X="7" Y="9"/></td>
								<td width="10%" ><img class="CCell" width="100%" id="Piece89" X="8" Y="9"/></td>
								<td width="10%"><img id="RoundRed" width="50%" src="/data/chess/150/space.png" /></td>
							</tr>
							<!-- TỌA ĐỘ-->
							<tr>
								<td width="10%" ><div class="text-center">9</div></td>
								<td width="10%" ><div class="text-center">8</div></td>
								<td width="10%" ><div class="text-center">7</div></td>
								<td width="10%" ><div class="text-center">6</div></td>
								<td width="10%" ><div class="text-center">5</div></td>
								<td width="10%" ><div class="text-center">4</div></td>
								<td width="10%" ><div class="text-center">3</div></td>
								<td width="10%" ><div class="text-center">2</div></td>
								<td width="10%" ><div class="text-center">1</div></td>
								<td width="10%" />
							</tr>
						</table>
					</div>
					<div class="row">
						<div class="text-justify" id="Note"/>
					</div>
				</div>
				<div class="col-md-6 col-sm-4" />
				<div class="col-md-6 col-sm-4" id="MoveList" tal:attributes="MoveStart Board/getMoveStart; MoveEnd Board/getMoveEnd; State Board/getState">
					<div class="row btn-row">
						<a tal:condition="Board/getSub" tal:attributes="href Board/getParent/getURLView" class="btn btn-sm" data-toggle="tooltip" data-placement="bottom" title="Về biến trước"><i class="glyphicon glyphicon-share-alt"/><span tal:content="Board/getSub"/></a>
						<div class="Move btn btn-sm" tal:attributes="alt Board/getState; move '-1'"><i class="glyphicon glyphicon-th-large"/></div>
						<div class="MoveFirst btn btn-sm" data-toggle="tooltip" data-placement="bottom" title="Di chuyển nước đầu tiên"><i class="glyphicon glyphicon-step-backward"/></div>
						<div class="MoveBack btn btn-sm" data-toggle="tooltip" data-placement="bottom" title="Di chuyển nước trước đó"><i class="glyphicon glyphicon-backward"/></div>
						<div class="Auto btn btn-sm btn-primary" data-toggle="tooltip" data-placement="bottom" title="Bật / tắt chế độ tự trình diễn chơi cờ"><i class="glyphicon glyphicon-play"/></div>
						<div class="MoveNext btn btn-sm" data-toggle="tooltip" data-placement="bottom" title="Di chuyển nước tiếp theo"><i class="glyphicon glyphicon-forward"/></div> 
						<div class="MoveLast btn btn-sm" data-toggle="tooltip" data-placement="bottom" title="Di chuyển nước cuối cùng"><i class="glyphicon glyphicon-step-forward"/></div>
						<select name="TimeAuto" id="TimeAuto" data-toggle="tooltip" data-placement="bottom" title="Số giây để hiển thị nước cờ tiếp theo">
							<option value="1" >1 giây</option>
							<option value="2" >2 giây</option>
							<option value="5" >5 giây</option>
							<option value="10" >10 giây</option>
						</select>
					</div>					
					<div class="row btn-row">
						<div role="tabpanel">
							<ul class="nav nav-tabs" role="tablist" id="PostTab">
								<li role="presentation"><a href="#board-related" aria-controls="home" role="tab" data-toggle="tab">xem thêm</a></li>
								<li role="presentation"><a href="#board-comment" aria-controls="profile" role="tab" data-toggle="tab">bình luận</a></li>
								<li role="presentation" class="active"><a href="#board-detail" aria-controls="profile" role="tab" data-toggle="tab">nước đi</a></li>
							</ul>
							<div class="tab-content">
								<div role="tabpanel" class="tab-pane" id="board-related">									
									<a class="btn btn-xs btn-primary" tal:attributes="href Board1/getURLView" tal:repeat="Board1 Board/getRelatedAll">
										<span tal:content="Board1/getName"/> (<span tal:content="Board1/getDetailAll/count"/>)
									</a>									
								</div>
								<div role="tabpanel" class="tab-pane" id="board-comment">
									<div 
										class="fb-comments" 
										tal:attributes="data-href Board/getURLShare" 
										data-numposts="5" data-colorscheme="light"
									/>
								</div>
								<div role="tabpanel" class="tab-pane active" id="board-detail">
									<div class="row btn-row" tal:repeat="Detail Board/getDetailAll">
										<span tal:content="php: sprintf('%03d', (Board->getMoveInit() + Detail->getMove()-1))" /> . 
										<div class="Move btn btn-xs btn-danger" 	tal:attributes="alt Detail/getState1; move Detail/getMove1; note Detail/getNote1; pre Detail/getPre1"><span tal:content="Detail/getName1"/></div>
										<div class="Move btn btn-xs btn-success"  	tal:attributes="alt Detail/getState2; move Detail/getMove2; note Detail/getNote2; pre Detail/getPre2"><span tal:content="Detail/getName2"/></div>
										<tal:block tal:condition="Detail/getSubAll/count">
											<a tal:attributes="href Sub/getBoardMe/getURLView" class="btn btn-xs btn-info" tal:repeat="Sub Detail/getSubAll">
												<span tal:content="Sub/getBoardMe/getName" />
											</a>
										</tal:block>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>			
		</div>
		<div id="Info" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" tal:content="Board/getName"/>
					</div>
					<div class="modal-body">
						<p>Số nước đi: <B tal:content="Board/getDetailAll/count"/> nước</p>
						<p>Kết quả: <B tal:content="Board/getRoundPrint"/>, <B tal:content="Board/getResultPrint"/></p>
						<p tal:content="structure Board/getInfo"/>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
					</div>
				</div>
			</div>
		</div>

		<div metal:use-macro="mFront.xhtml/IncludeJS"/>
		<script type="text/javascript">
		/*<![CDATA[*/			
			$(function(){			
				var tmrAuto;
				var Auto 		= 1;
				var TimeAuto	= 1000;
				var MoveCurrent = -1;
				var MoveSTART 	= parseInt($("#MoveList").attr("MoveStart"));
				var MoveEND 	= parseInt($("#MoveList").attr("MoveEnd"));
				var State 		= $("#MoveList").attr("State");
				
				//KHỞI TẠO CHẾ ĐỘ XEM LẠI VÁN CỜ
				initViewer(State);
				
				//Các tiện ích
				function moveFirst(){
					MoveCurrent = MoveSTART;					
					var State 	= $(".Move[move='"+MoveCurrent+"']").attr('alt');
					var Pre 	= $(".Move[move='"+MoveCurrent+"']").attr('pre');
					$(".Move").removeClass('active');
					$(".Move[move='"+MoveCurrent+"']").addClass('active');					
					drawBoard(State, Pre);
					drawRound1(MoveCurrent);
					$("#Note").html($(".Move[move='"+MoveCurrent+"']").attr('note'));
				}
				function moveLast(){
					MoveCurrent = MoveEND;
					var State 	= $(".Move[move='"+MoveCurrent+"']").attr('alt');
					var Pre 	= $(".Move[move='"+MoveCurrent+"']").attr('pre');
					$(".Move").removeClass('active');
					$(".Move[move='"+MoveCurrent+"']").addClass('active');
					drawBoard(State, Pre);
					drawRound1(MoveCurrent);
					$("#Note").html($(".Move[move='"+MoveCurrent+"']").attr('note'));
				}
				function moveNext(){
					if (MoveCurrent < MoveEND){
						MoveCurrent +=1;						
						var State 	= $(".Move[move='"+MoveCurrent+"']").attr('alt');
						var Pre 	= $(".Move[move='"+MoveCurrent+"']").attr('pre');
						//alert(Pre);
						$(".Move").removeClass('active');
						$(".Move[move='"+MoveCurrent+"']").addClass('active');						
						drawBoard(State, Pre);
						drawRound1(MoveCurrent);
						$("#Note").html($(".Move[move='"+MoveCurrent+"']").attr('note'));
					}
				}
				function moveBack(){
					if (MoveCurrent > MoveSTART){
						MoveCurrent -=1;
						var State 	= $(".Move[move='"+MoveCurrent+"']").attr('alt');
						var Pre 	= $(".Move[move='"+MoveCurrent+"']").attr('pre');
						$(".Move").removeClass('active');
						$(".Move[move='"+MoveCurrent+"']").addClass('active');
						drawBoard(State, Pre);
						drawRound1(MoveCurrent);
						$("#Note").html($(".Move[move='"+MoveCurrent+"']").attr('note'));
					}
				}
				function runAuto(){
					TimeAuto	= parseInt($("#TimeAuto").val())*1000;
					Auto = Auto*(-1);
					if (Auto>0){
						$(".Auto").html("<i class='glyphicon glyphicon-play'/>");
						clearTimeout(tmrAuto);
					}else{						
						$(".Auto").html("<i class='glyphicon glyphicon-stop'/>");
						tmrAuto = setInterval(function(){
							if (MoveCurrent < MoveEND){
								MoveCurrent +=1;						
								var State 	= $(".Move[move='"+MoveCurrent+"']").attr('alt');
								var Pre 	= $(".Move[move='"+MoveCurrent+"']").attr('pre');
								$(".Move").removeClass('active');
								$(".Move[move='"+MoveCurrent+"']").addClass('active');
								drawBoard(State, Pre);
								drawRound1(MoveCurrent);
								$("#Note").html($(".Move[move='"+MoveCurrent+"']").attr('note'));
							}else{
								MoveCurrent = MoveSTART;
							}
						}, TimeAuto);
					}
				}
								
				document.onkeydown = function(event) {
					if (!event)
						event = window.event;
					var code = event.keyCode;
					if (event.charCode && code == 0)
						code = event.charCode;
					switch(code) {
						case 37:
							// Key left.
							moveBack();
							break;
						case 38:
							// Key up.
							moveFirst();
							break;
						case 39:
							// Key right.							
							moveNext();
							break;
						case 40:
							// Key down.							
							moveLast();
							break;
						case 13:
							runAuto();
							break;
						case 27:
							runAuto();
							break;	
					}
					event.preventDefault();
				};
							
								
				$(".Move").click(function(){
					MoveCurrent = parseInt($(this).attr('move'));
					$(".Move").removeClass('active');
					$(".Move[move='"+MoveCurrent+"']").addClass('active');					
					drawBoard($(this).attr('alt'));
					drawRound1(MoveCurrent);
					
					$("#Note").html($(".Move[move='"+MoveCurrent+"']").attr('note'));
				});
				
				$('.Auto').bind('click', runAuto);
				$('.MoveNext').bind('click', moveNext);
				$(".MoveBack").bind('click', moveBack);				
				$(".MoveFirst").bind('click', moveFirst);												
				$(".MoveLast").bind('click', moveLast);
				
				$(".Liked").click(function(){									
					//-----------------------------------------------------------------------------------			
					var IdBoard = $(this).attr('data-id');
													
					var URL = "/object/liked/Board/"+IdBoard;
					$.ajax({
						type: "POST",						
						url: URL,
						success: function(msg){
							location.reload();
						}
					});			
				});
				
				$('[data-toggle="tooltip"]').tooltip();
				
				(function(d, s, id) {
				  var js, fjs = d.getElementsByTagName(s)[0];
				  if (d.getElementById(id)) return;
				  js = d.createElement(s); js.id = id;
				  js.src = "//connect.facebook.net/vi_VN/sdk.js#xfbml=1&appId=1550985445183957&version=v2.0";
				  fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
				});
		/*]]>*/
		</script>
	</body>
</html>