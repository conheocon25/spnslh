<!DOCTYPE html>
<html lang="en">
	<head>
		<div metal:use-macro="mGebo.xhtml/IncludeMETA"/>
		<div metal:use-macro="mGebo.xhtml/IncludeCSS"/>
		<link rel="stylesheet" href="/mvc/templates/theme/cchess/css/style.css"/>
	</head>
	
	<body>
		<div id="maincontainer" class="clearfix no-bg">
            <div metal:use-macro="mGebo.xhtml/Header"/>
            <div id="contentwrapper">
                <div class="main_content">
				
                    <div class="row-fluid">
						<div class="span8">
							<div class="well">
								<div class="base-board">
									<canvas id="ChessBoard"></canvas>
								</div>
							</div>
						</div>
						<div class="span4">
							<div class="well">
								<h4 tal:content="CS/getName"/>
								(<span tal:content="CS/getCountPrint"/> xem)
								<div tal:repeat="Step CS/getStepAll">
									<span class='btn btn-danger iStep' 	tal:attributes="alt Step/getContent1"><span tal:content="Step/getName1"/></span>
									<span class='btn btn-info 	iStep' 	tal:attributes="alt Step/getContent2"><span tal:content="Step/getName2"/></span>
								</div>
								<div id="DataMove" tal:attributes="alt CS/getStepAllPrint"/>
							</div>
						</div>
					</div>
					
                </div>
            </div>
		</div>
		
		<div metal:use-macro="mGebo.xhtml/IncludeJS"/>
		<script src="/mvc/templates/theme/cchess/js/piece.js"></script>	
		<script src="/mvc/templates/theme/cchess/js/board.js"></script>
		<script>
			/*<![CDATA[*/
			window.onload = function() {
				
				var canvas 		= document.getElementById("ChessBoard");			
				var context 	= canvas.getContext("2d");
				var Rect 		= canvas.getBoundingClientRect();
				var bsBoard		= $('.base-board').width();
				
				canvas.width 	= bsBoard;
				canvas.height 	= bsBoard + (bsBoard/8);
				
				$("#ChessBoard").css("box-shadow", "0 0 0 "+((bsBoard/8)/3)+"px #ADD8E6 inset");				
				var VC			= new Board("Van1", ((bsBoard/8)/3)+5, ((bsBoard/8)/3)+5, Rect, ((bsBoard-((((bsBoard/8)/3)+5)*2))/8)-1.7, ((canvas.height-((((bsBoard/8)/3)+5)*2))/9)-1.8);
				
				//KHỞI TẠO BÀN CỜ
				VC.init();
				VC.getStepAllLoad($("#DataMove").attr('alt'));

				//canvas.addEventListener('click', function(e){VC.click(e);}, false);
				
				context.clearRect(0, 0, canvas.width, canvas.height);
				VC.draw(canvas, context);
				$("#MoveList").html(VC.getStepAll());

				//XỬ LÍ NƯỚC ĐI
				$('.iStep').click(function(){
					var move = $(this).attr('alt');					
					VC.setState(move);
					context.clearRect(0, 0, canvas.width, canvas.height);
					VC.draw(canvas, context);
				});
				
			}
			/*]]>*/
		</script>
	</body>
</html>