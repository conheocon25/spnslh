<body>
	<div class="panel panel-primary" id="InvoiceView" tal:attributes="alt Invoice/getURLLoad">
		<div class="panel-heading"><i class="glyphicon glyphicon-star"/> <B tal:content="php: 'ĐƠN HÀNG ' . Invoice->getDateTimeCreatedPrint()"/></div>
		<div class="panel-body">
			<table width="100%">
				<tr>
					<td width="45%">TẠO LÚC</td>
					<td width="45%"><B tal:content="Invoice/getDateTimeCreatedPrint" /></td>
					<td width="10%" />
				</tr>
				<tr>
					<td width="45%">LẦN CUỐI</td>
					<td width="45%"><B tal:content="Invoice/getDateTimeUpdatedPrint" /></td>
					<td width="10%" />
				</tr>
				<tr>
					<td width="45%">NHÂN VIÊN BÁN</td>
					<td width="45%">
						<a href="#DialogChooseEmployee" data-toggle="modal" 
								class="invoice-item"
								tal:attributes="id 				Invoice/getId;
											id_employee 		Invoice/getIdEmployee;
											id_customer 		Invoice/getIdCustomer;
											datetime_created 	Invoice/getDateTimeCreated;
											datetime_updated	Invoice/getDateTimeUpdated;
											note 				Invoice/getNote;
											state 				Invoice/getState;"
						><B tal:content="Invoice/getEmployee/getName" /></a>
					</td>
					<td width="10%" />
				</tr>
				<tr>
					<td width="45%">TÌNH TRẠNG</td>
					<td width="45%"><B tal:content="Invoice/getStatePrint" /></td>
					<td width="10%" />											
				</tr>
			</table>
			<BR/>			
			<table class="table table-striped table-hover">
				<thead>
					<tr>										
						<th width="30">STT</th>
						<th><div class="text-left">TÊN</div></th>
						<th width="60"><div class="text-right">SL</div></th>
						<th width="120"><div class="text-right">Đ.GIÁ</div></th>
						<th width="120"><div class="text-right">T.TIỀN</div></th>
						<th width="30"><i class="glyphicons-bin"/></th>
					</tr>
				</thead>
				<tbody>
					<tr tal:repeat="Detail Invoice/getDetailAll">
						<td><div class="text-center" tal:content="repeat/Detail/number" /></td>
						<td><a class="invoice-detail-item" href="#DialogEdit" data-toggle="modal" 
							tal:attributes="id 			Detail/getId;
											id_good 	Detail/getIdGood;
											name_good	Detail/getGood/getName;
											count 		Detail/getCount;
											price 		Detail/getPrice;											
							" 
							tal:content="Detail/getGood/getName"/>
						</td>
						<td><div class="text-center" tal:content="Detail/getCountPrint"/></td>
						<td><div class="text-right" tal:content="Detail/getPricePrint"/></td>
						<td><div class="text-right" tal:content="Detail/getValuePrint"/></td>
						<td>
							<div class="text-right">
								<a class="btn btn-default remove-item" href="#DialogDel" data-toggle="modal" tal:attributes="data-id Detail/getId"><i class="glyphicon glyphicon-remove"/></a>
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="4"><div class="text-right"><B>TỔNG CỘNG</B></div></td>
						<td><div class="text-right"><B tal:content="Invoice/getValuePrint" /></div></td>
						<td/>
					</tr>
				</tbody>
			</table>			
			<a title="In phiếu" class="Ticket btn" tal:attributes="alt Invoice/getURLPrint"><i class="glyphicon glyphicon-print"/> IN PHIẾU</a>
		</div>
	</div>
	
	<!-- DIALOG SESSION EDIT	-->
	<div id="DialogChooseEmployee" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header"><h3><i class="glyphicon glyphicon-user modal-icon"/>CẬP NHẬT ĐƠN HÀNG</h3></div>				
				<form id="FormInvoiceUpdate" action="#" class="form-horizontal" novalidate="novalidate">					
					<input id="InvoiceId" type="hidden" />
					<input id="InvoiceIdCustomer" type="hidden" />
					<div class="form-group">
						<label class="col-sm-3 control-label">Khởi tạo</label>
						<div class="col-sm-8 controls">
							<input id="InvoiceDateTimeCreated" type="text" class="form-control input-small" data-date-format="yyyy-mm-dd hh:ii"/>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Cập nhật cuối</label>
						<div class="col-sm-8 controls">
							<input id="InvoiceDateTimeUpdated" type="text" class="form-control input-small" data-date-format="yyyy-mm-dd hh:ii"/>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Ghi chú</label>
						<div class="col-sm-8 controls">
							<input id="InvoiceNote" type="text" class="form-control input-small" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Tình trạng</label>
						<div class="col-sm-8 controls">							
							<select id="InvoiceState" style="width:100%;" class="form-control">
								<option tal:attributes="value string:0;selected php:Invoice->getState()==0?true:false">Chờ duyệt</option>
								<option tal:attributes="value string:1;selected php:Invoice->getState()==1?true:false">Duyệt xong</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Nhân viên</label>
						<div class="col-sm-8 controls">
							<select id="InvoiceIdEmployee" style="width:100%;" class="form-control">
								<option tal:repeat="Employee EmployeeAll" tal:attributes="value Employee/getId;selected php:Employee->getId()==Invoice->getIdEmployee()?true:false">
									<span tal:content="Employee/getName" />
								</option>
							</select>
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary btn-small" id="URLInvoiceUpdButton"><i class="glyphicons-download_alt"/> Lưu</button>
						<button data-dismiss="modal" class="btn btn-default btn-small"><i class="glyphicons-undo"/> Hủy</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</body>
<script>
	$(".invoice-item").click(function(){
		var InvoiceId 				= $(this).attr('id');		
		var InvoiceIdCustomer 		= $(this).attr('id_customer');
		var InvoiceDateTimeCreated 	= $(this).attr('datetime_created');
		var InvoiceDateTimeUpdated 	= $(this).attr('datetime_updated');		
		var InvoiceNote 			= $(this).attr('note');
				
		$('#URLInvoiceUpdButton').attr('alt', InvoiceId);
		$("#InvoiceId").val(InvoiceId);		
		$("#InvoiceIdCustomer").val(InvoiceIdCustomer);
		$("#InvoiceDateTimeCreated").val(InvoiceDateTimeCreated);
		$("#InvoiceDateTimeUpdated").val(InvoiceDateTimeUpdated);
		$("#InvoiceNote").val(InvoiceNote);			
	});
	
	//-----------------------------------------------------------------------------------
	//Update 1 INVOICE CURRENT
	//-----------------------------------------------------------------------------------
	$("#FormInvoiceUpdate").validate({
		rules:{
			Name2:{
				minlength: 2,
				required:true
			}					
		},
		errorClass: "help-inline",
		errorElement: "span",
		highlight:function(element, errorClass, validClass) {
			$(element).parents('.form-group').addClass('has-error');
		},
		unhighlight: function(element, errorClass, validClass) {
			$(element).parents('.form-group').removeClass('has-error');
			$(element).parents('.form-group').addClass('has-success');
		},
		submitHandler: function (form) {					
			var Data = [];
			Data[0] = $('#URLInvoiceUpdButton').attr('alt');
			Data[1] = $('#InvoiceIdEmployee').val();
			Data[2] = $('#InvoiceIdCustomer').val();
			Data[3] = $('#InvoiceDateTimeCreated').val();
			Data[4] = $('#InvoiceDateTimeUpdated').val();
			Data[5] = $('#InvoiceNote').val();				
			Data[6] = $('#InvoiceState').val();
																
			var URL = "/object/upd/InvoiceSell";
			$.ajax({
				type: "POST",
				data: {Data:Data},
				url: URL,
				success: function(msg){					
					var URL1 = "/ql-ban-hang/khach-hang/" + $('#InvoiceIdCustomer').val()+"/"+$('#URLInvoiceUpdButton').attr('alt');					
					$("#InvoiceView").load(URL1);
				}
			});
			return false;
		}
	});
	
	$(".Ticket").click(function(){
		var url = $(this).attr('alt');
		var thePopup = window.open( url, "In Phiếu", "menubar=0,location=0,height=700,width=700" );
		thePopup.print();
	});
			
</script>