<body>
	<div id="InvoicePanel" class="panel panel-primary" tal:attributes="alt Invoice/getURLBranchLoad;">
		<div class="panel-heading"><i class="glyphicon glyphicon-star"/> <B tal:content="php: 'HÓA ĐƠN' . Invoice->getCustomer()->getName()"/></div>
		<div class="panel-body">
			<table width="100%">				
				<tr>
					<td width="35%">TẠO LÚC</td>
					<td width="45%"><B tal:content="Invoice/getDateTimeCreatedPrint" /></td>					
				</tr>				
				<tr>
					<td width="35%">NHÂN VIÊN LẬP</td>
					<td width="45%"><B tal:content="Invoice/getEmployee/getName" /></td>
				</tr>				
			</table>
			<BR/>			
			<table class="table table-striped table-hover">
				<thead>
					<tr>										
						<th width="30">STT</th>
						<th><div class="text-left">TÊN</div></th>
						<th width="60"><div class="text-left">ĐVT</div></th>
						<th width="90"><div class="text-right">SL</div></th>
						<th width="90"><div class="text-right">ĐƠN GIÁ</div></th>						
						<th width="120"><div class="text-right">T.TIỀN</div></th>
						<th width="30"><i class="glyphicon glyphicon-trash"/></th>
					</tr>
				</thead>
				<tbody>
					<tr tal:repeat="Detail Invoice/getDetailAll">
						<td><div class="text-center" tal:content="repeat/Detail/number" /></td>
						<td><a 
							tal:condition="php:Invoice->getState()==0?true:false"
							class="Invoice-detail-item" href="#DialogGoodUpd" data-toggle="modal" 
							tal:attributes="id 			Detail/getId;
											id_Invoice 	Detail/getIdInvoice;
											id_good 	Detail/getIdGood;
											name_good	Detail/getGood/getName;
											count 		Detail/getCount;
											price 		Detail/getPrice;											
							" 
							tal:content="Detail/getGood/getName"/>														
						</td>
						<td><div class="text-left" tal:content="Detail/getGood/getUnit"/></td>
						<td><div class="text-right" tal:content="Detail/getCountPrint"/></td>
						<td><div class="text-right" tal:content="Detail/getPricePrint"/></td>						
						<td><div class="text-right" tal:content="Detail/getValuePrint"/></td>
						<td>
							<div class="text-right">
								<a class="remove-detail-item" href="#DialogDel" data-toggle="modal" tal:attributes="data-id Detail/getId"><i class="glyphicon glyphicon-remove"/></a>
							</div>
						</td>
					</tr>					
					<tr>
						<td class="text-right" colspan="5">TC</td>
						<td class="text-right" ><B tal:content="Invoice/getValuePrint"/></td>
						<td />
					</tr>
				</tbody>
			</table>
			<!--
			<a class="btn btn-default" tal:condition="php:Invoice->getState()==0?true:false" href="#DialogGoodIns" data-toggle="modal"><i class="glyphicon glyphicon-plus"/> HÀNG HÓA</a> 
			<a class="Mail btn btn-default" tal:condition="php:Invoice->getState()==0?true:false" tal:attributes="data-url Invoice/getURLMail">
				<i class="glyphicon glyphicon-envelope"/> GỬI TRÌNH
			</a>
			<a class="Ticket btn btn-default" tal:condition="php:Invoice->getState()>=2?true:false" tal:attributes="alt Invoice/getURLPrint"><i class="glyphicon glyphicon-print"/> IN LƯU</a>
			!-->
		</div>
	</div>
		
	<!-- DIALOG GOOD INS -->
	<div id="DialogGoodIns" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header"><h3><i class="glyphicon glyphicon-star modal-icon"/>THÊM HÀNG HÓA</h3></div>
				<div id="FormGoodIns" class="form-horizontal">
					<input id="IdInvoice1" type="hidden" class="form-control input-small" tal:attributes="value Invoice/getId"/>
					<div class="form-group">
						<label class="col-sm-3 control-label">Hàng hóa</label>
						<div class="col-sm-8 controls">
							<select id="IdGood1" style="width:100%;" class="form-control">
								<option tal:repeat="Good GoodAll" tal:attributes="value Good/getId">
									<span tal:content="Good/getGroup/getName" /> / <span tal:content="Good/getName" />
								</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Số lượng xin</label>
						<div class="col-sm-8 controls">
							<input id="Count1" type="text" class="form-control input-small" value="1"/>
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary btn-small" id="URLGoodInsButton"><i class="glyphicons-download_alt"/> Cập nhật</button>
						<button data-dismiss="modal" class="btn btn-default btn-small"><i class="glyphicons-undo"/> Hủy</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- DIALOG GOOD UPD-->
	<div id="DialogGoodUpd" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header"><h3><i class="glyphicon glyphicon-star modal-icon"/>CẬP NHẬT HÀNG HÓA</h3></div>
				<div id="FormGoodIns" class="form-horizontal">					
					<div class="form-group">
						<input id="Id2" type="hidden" class="form-control input-small" />
						<input id="IdInvoice2" type="hidden" class="form-control input-small" />
						<input id="IdGood2" type="hidden" class="form-control input-small" />						
						<label class="col-sm-3 control-label">Mặt hàng</label>
						<div class="col-sm-8 controls">
							<input id="NameGood2" type="text" class="form-control input-small" readonly="true" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Số lượng</label>
						<div class="col-sm-8 controls">
							<input id="Count2" type="text" class="form-control input-small" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Đơn giá</label>
						<div class="col-sm-8 controls">
							<input id="Price2" type="text" class="form-control input-small" />
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary btn-small" id="URLGoodUpdButton"><i class="glyphicons-download_alt"/> Cập nhật</button>
						<button data-dismiss="modal" class="btn btn-default btn-small"><i class="glyphicons-undo"/> Hủy</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div metal:use-macro="mDialog.xhtml/DialogDel"/>
	
</body>
<script>				
	//Chèn vào HÀNG HÓA MỚI
	$("#URLGoodInsButton").click(function(){								
		var Data = [];		
		Data[0] = null;
		Data[1] = $("#IdInvoice1").val();
		Data[2] = $("#IdGood1").val();
		Data[3] = $("#Count1").val();
		Data[4] = 0;
		Data[5] = 0;
		
		var URL = "/object/ins/InvoiceSellDetail";
		$.ajax({
			type: "POST",
			data: {Data:Data},
			url: URL,
			success: function(msg){
				var URL = $("#InvoicePanel").attr('alt');
				$("#InvoiceView").load(URL);
			}
		});
	});
		
	//Cập nhật HÀNG HÓA MỚI
	$(".Invoice-detail-item").click(function(){						
		$("#Id2").val( $(this).attr('id') );
		$("#IdInvoice2").val( $(this).attr('id_Invoice') );
		$("#IdGood2").val( $(this).attr('id_good') );
		$("#NameGood2").val( $(this).attr('name_good') );
		$("#Count2").val( $(this).attr('count') );
		$("#Price2").val( $(this).attr('price') );
	});
	
	$("#URLGoodUpdButton").click(function(){							
		var Data = [];		
		Data[0] = $("#Id2").val();
		Data[1] = $("#IdInvoice2").val();
		Data[2] = $("#IdGood2").val();
		Data[3] = $("#Count2").val();
		Data[4] = $("#Price2").val();
						
		var URL = "/object/upd/InvoiceSellDetail";
		$.ajax({
			type: "POST",
			data: {Data:Data},
			url: URL,
			success: function(msg){
				var URL = $("#InvoicePanel").attr('alt');
				$("#InvoiceView").load(URL);
			}
		});							
	});
	
	//-----------------------------------------------------------------------------------
	//Delete 1 DETAIL			
	//-----------------------------------------------------------------------------------
	$('.remove-detail-item').click(function(){
		$('#URLDelButton').attr('alt', $(this).attr('data-id'));
	});	
	$('#URLDelButton').click(function(){			
		var URL = "/object/del/InvoiceSellDetail/" + $(this).attr('alt');
		$.ajax({
			type: "POST",					
			url: URL,
			success: function(msg){
				var URL = $("#InvoicePanel").attr('alt');
				$("#InvoiceView").load(URL);
			}
		});
	});
		
	//-----------------------------------------------------------------------------------
	//IN LỆNH
	//-----------------------------------------------------------------------------------	
	$(".Ticket").click(function(){
		var url = $(this).attr('alt');
		var thePopup = window.open( url, "In Phiếu", "menubar=0,location=0,height=700,width=700" );
		thePopup.print();
	});
</script>