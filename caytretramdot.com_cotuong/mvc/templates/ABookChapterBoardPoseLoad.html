<!DOCTYPE html>
<html lang="en">
	<head>
		<div metal:use-macro="mFront.xhtml/IncludeMETA"/>
		<div metal:use-macro="mFront.xhtml/IncludeCSS"/>
	</head>
	<body>		
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6 col-sm-6">
					<table width="100%" border="0" cellspacing="0" cellpadding="0" style="background-image: url(/data/chess/150/Board.jpg); background-repeat:no-repeat; background-size: 80% 100%;">
						<!-- TỌA ĐỘ-->
						<tr>
							<td width="8%" ><div class="text-center">1</div></td>
							<td width="8%" ><div class="text-center">2</div></td>
							<td width="8%" ><div class="text-center">3</div></td>
							<td width="8%" ><div class="text-center">4</div></td>
							<td width="8%" ><div class="text-center">5</div></td>
							<td width="8%" ><div class="text-center">6</div></td>
							<td width="8%" ><div class="text-center">7</div></td>
							<td width="8%" ><div class="text-center">8</div></td>
							<td width="8%" ><div class="text-center">9</div></td>
							<td width="8%" />
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
						
						<!-- R0-->
						<tr>
							<!--
							<td id="Border00" style="background-image: url(/data/chess/150/Select.png); background-size: 100% 100%" width="10%" ><img class="CCell" width="100%" id="Piece00" X="0" Y="0"/></td>
							!-->
							<td id="Border00" width="8%" ><img class="CCell" width="100%" id="Piece00" X="0" Y="0"/></td>
							<td id="Border01" width="8%" ><img class="CCell" width="100%" id="Piece10" X="1" Y="0"/></td>
							<td id="Border02" width="8%" ><img class="CCell" width="100%" id="Piece20" X="2" Y="0"/></td>
							<td id="Border03" width="8%" ><img class="CCell" width="100%" id="Piece30" X="3" Y="0"/></td>
							<td id="Border04" width="8%" ><img class="CCell" width="100%" id="Piece40" X="4" Y="0"/></td>
							<td id="Border05" width="8%" ><img class="CCell" width="100%" id="Piece50" X="5" Y="0"/></td>
							<td id="Border06" width="8%" ><img class="CCell" width="100%" id="Piece60" X="6" Y="0"/></td>
							<td id="Border07" width="8%" ><img class="CCell" width="100%" id="Piece70" X="7" Y="0"/></td>
							<td id="Border08" width="8%" ><img class="CCell" width="100%" id="Piece80" X="8" Y="0"/></td>
							<td width="8%"><img id="RoundGreen" width="50%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
						
						<!-- R1-->
						<tr>
							
							<td width="8%" ><img class="CCell" width="100%" id="Piece01" X="0" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece11" X="1" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece21" X="2" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece31" X="3" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece41" X="4" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece51" X="5" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece61" X="6" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece71" X="7" Y="1"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece81" X="8" Y="1"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>								
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
						
						<!-- R2-->
						<tr>
							
							<td width="8%" ><img class="CCell" width="100%" id="Piece02" X="0" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece12" X="1" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece22" X="2" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece32" X="3" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece42" X="4" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece52" X="5" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece62" X="6" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece72" X="7" Y="2"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece82" X="8" Y="2"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
													
						<!-- R3-->
						<tr>
							
							<td width="8%" ><img class="CCell" width="100%" id="Piece03" X="0" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece13" X="1" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece23" X="2" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece33" X="3" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece43" X="4" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece53" X="5" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece63" X="6" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece73" X="7" Y="3"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece83" X="8" Y="3"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
													
						<!-- R4-->
						<tr>								
							<td width="8%" ><img class="CCell" width="100%" id="Piece04" X="0" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece14" X="1" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece24" X="2" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece34" X="3" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece44" X="4" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece54" X="5" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece64" X="6" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece74" X="7" Y="4"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece84" X="8" Y="4"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>														
						<!-- R5-->
						<tr>								
							<td width="8%" ><img class="CCell" width="100%" id="Piece05" X="0" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece15" X="1" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece25" X="2" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece35" X="3" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece45" X="4" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece55" X="5" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece65" X="6" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece75" X="7" Y="5"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece85" X="8" Y="5"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>														
						<!-- R6-->
						<tr>								
							<td width="8%" ><img class="CCell" width="100%" id="Piece06" X="0" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece16" X="1" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece26" X="2" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece36" X="3" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece46" X="4" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece56" X="5" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece66" X="6" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece76" X="7" Y="6"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece86" X="8" Y="6"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>								
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>														
						<!-- R7-->
						<tr>
							<td width="8%" ><img class="CCell" width="100%" id="Piece07" X="0" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece17" X="1" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece27" X="2" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece37" X="3" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece47" X="4" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece57" X="5" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece67" X="6" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece77" X="7" Y="7"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece87" X="8" Y="7"/></td>
							<td width="8%"><img width="100%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>														
						<!-- R8-->
						<tr>
							<td width="8%" ><img class="CCell" width="100%" id="Piece08" X="0" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece18" X="1" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece28" X="2" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece38" X="3" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece48" X="4" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece58" X="5" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece68" X="6" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece78" X="7" Y="8"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece88" X="8" Y="8"/></td>
							<td width="8%" ><img width="100%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
																										
						<!-- R9-->
						<tr>
							<td width="8%" ><img class="CCell" width="100%" id="Piece09" X="0" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece19" X="1" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece29" X="2" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece39" X="3" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece49" X="4" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece59" X="5" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece69" X="6" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece79" X="7" Y="9"/></td>
							<td width="8%" ><img class="CCell" width="100%" id="Piece89" X="8" Y="9"/></td>
							<td width="8%" ><img id="RoundRed" width="50%" src="/data/chess/150/space.png" /></td>
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
						<!-- TỌA ĐỘ-->
						<tr>
							<td width="8%" ><div class="text-center">9</div></td>
							<td width="8%" ><div class="text-center">8</div></td>
							<td width="8%" ><div class="text-center">7</div></td>
							<td width="8%" ><div class="text-center">6</div></td>
							<td width="8%" ><div class="text-center">5</div></td>
							<td width="8%" ><div class="text-center">4</div></td>
							<td width="8%" ><div class="text-center">3</div></td>
							<td width="8%" ><div class="text-center">2</div></td>
							<td width="8%" ><div class="text-center">1</div></td>
							<td width="8%" />
							<td width="8%" />
							<td width="8%" />
							<td width="4%" />
						</tr>
					</table>					
				</div>
				<div id="MoveList" class="col-md-3 col-xs-3" tal:attributes="MoveStart Board/getMoveStart; MoveEnd Board/getMoveEnd; URLExe Board/getURLSettingPoseExe; State Board/getState; ;MoveInit Board/getMoveInit">
					<div class="row">
						<div class="MoveSave btn btn-primary">Lưu</div>						
						<div class="MoveBack btn btn-primary"> < </div>
						<div class="MoveState btn btn-default">?</div>
						<a tal:attributes="href Board/getURLSettingStateLoad" class="btn btn-success">Thiết lập trạng thái</a>
					</div>
					<div class="row">						
						<table id="StateList" width="100%" border="1" cellpadding="5">
							<tr>
								<td width="30%" align="center"><B>STT</B></td>
								<td width="70%"><B>Nước đi</B></td>
							</tr>
						</table>
					</div>					
				</div>
				<div class="col-md-3 col-sm-3">
					<div class="panel panel-default">
						<div class="panel-heading">
							<a tal:attributes="href Chapter/getURLSettingBoard">
								<span tal:content="Chapter/getTitle"/>
							</a>
						</div>
						<div class="panel-body">
							<a tal:attributes="href Board1/getURLSettingPoseLoad;class php: Board1->getId()==Board->getId()?'btn btn-primary btn-block':'btn btn-default btn-block'"  tal:repeat="Board1 Chapter/getBoardAll">
								<span tal:content="Board1/getName"/>
							</a>
						</div>
					</div>
				</div>
			</div>			
		</div>
		<div metal:use-macro="mFront.xhtml/IncludeJS"/>
		<script type="text/javascript">
		/*<![CDATA[*/			
			$(function(){
				var TempPiece 	= '';
				var TempPiece 	= '';
				var TempX 		= -1;
				var TempY 		= -1;
				var State		= $("#MoveList").attr('State');
				var Selected	= 0;
																
				//Khởi tạo dữ liệu bàn cờ												
				initCompose(State);
				drawRound(Round);
				drawIState(iStep);
								
				
				$(".CCell").click(function(){
					var X = parseInt($(this).attr('X'));
					var Y = parseInt($(this).attr('Y'));
					var Color = isColor(aState[Y][X]);
					
					//Hành vi chọn quân
					if (aState[Y][X] != '0' && Selected == 0 && Color==Round){
						TempPiece = aState[Y][X];
						TempX = X;						
						TempY = Y;
						Selected = 1;						
					}
					else if (Selected == 1){
						if (!(TempX == X && TempY == Y)){
							//Di chuyển quân
							if (aState[Y][X] == '0'){
								iStep++;
								
								aStepA[iStep] = exportStep(TempY, TempX, Y, X);
								movePiece(TempY, TempX, Y, X);
								State = exportState();
								drawBoard(State);
								Selected = 0;
								Round = Round*(-1);
								drawRound(Round);
								
								drawMoveState();
								drawIState(iStep);
								aStep[iStep] = State;
							}
							//Ăn quân
							else{
								iStep++;
								
								aStepA[iStep] 	= exportStep(TempY, TempX, Y, X);
								movePiece(TempY, TempX, Y, X);
								State = exportState();
								drawBoard(State);
								Selected = 0;
								Round = Round*(-1);
								drawRound(Round);
								
								drawMoveState();
								drawIState(iStep);
								aStep[iStep] 	= State;
							}							
						}						
					}
				});
				$(".MoveSave").click(function(){
					var URL = $("#MoveList").attr('URLExe');
																									
					$.ajax({
						type: "POST",
						data: {aStep:aStep, aStepA:aStepA},
						url: URL,
						success: function(msg){							
							alert("Đã cập nhật nước đi mới cho ván cờ !");
						}
					});
				});
				
				//Tua tới và tua lui
				$(".MoveBack").click(function(){					
					$('#StateList tr:last').remove();					
					Round =  Round*(-1);
					iStep--;
					Selected = 0;
					
					updateAState(aStep[iStep]);
					drawBoard(aStep[iStep]);
					drawIState(iStep);
					drawRound(Round);
										
				});				
			});
		/*]]>*/
		</script>
	</body>
</html>